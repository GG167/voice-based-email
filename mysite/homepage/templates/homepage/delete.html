{% extends 'base_layout.html' %}

{% block content %}
<body onload="DeleteEmails()">
    <nav class="navbar navbar-dark navbar-expand-lg fixed-top bg-dark navbar-custom">
        <div class="container">
            <a class="navbar-brand" style="font-size:150%;">VOICE BASED EMAIL FOR THE BLIND</a>
        </div>
    </nav>

    <header class="masthead text-left text-white">
        <div class="masthead-content">
            <div class="container">
                <center>
                    <h4 class="masthead-heading mb-0" style="margin-top: -100px; font-size: 70px; color: black;">
                        DELETE EMAIL
                    </h4>
                    <br>
                    <h2>Use voice commands to delete emails.</h2>
                    <h3>The system will ask for the sender/email and delete matching emails after confirmation.</h3>
                </center>
                <br>
            </div>
        </div>
        <div class="bg-circle-1 bg-circle"></div>
        <div class="bg-circle-2 bg-circle"></div>
        <div class="bg-circle-3 bg-circle"></div>
        <div class="bg-circle-4 bg-circle"></div>
    </header>

    <footer class="py-5 bg-black">
        <div class="container">
            <p class="text-center text-white m-0 small">Copyright&nbsp;Â© Voice Based Email&nbsp;</p>
        </div>
    </footer>

    <script>
        function DeleteEmails() {
            // Automatically trigger deletion process when page loads
            $.ajax({
                url: "{% url 'homepage:delete' %}",  // calls your delete_view
                method: 'POST',
                data: { 'csrfmiddlewaretoken': '{{ csrf_token }}' },
                success: function (data) {
                    if (data.result === 'success') {
                        text_to_speech("Deletion completed. Returning to main menu.");
                        setTimeout(() => {
                            window.location = "{% url 'homepage:options' %}";
                        }, 2000);
                    } else if (data.result === 'failure') {
                        text_to_speech("Could not complete deletion. Please try again.");
                        setTimeout(() => {
                            window.location = "{% url 'homepage:delete' %}";
                        }, 2000);
                    } else if (data.result === 'logout') {
                        window.location = "{% url 'homepage:login' %}";
                    }
                }
            });
        }

        // Optional: define text_to_speech for client-side feedback (if needed)
        function text_to_speech(message) {
            if ('speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(message);
                window.speechSynthesis.speak(utterance);
            }
        }
    </script>
</body>
{% endblock %}
